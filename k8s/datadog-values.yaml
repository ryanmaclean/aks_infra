# Datadog Helm Values for AKS
# Modernized: January 2026
# Reference: https://github.com/DataDog/helm-charts/blob/main/charts/datadog/values.yaml

targetSystem: "linux"

datadog:
  # API Key - set via --set or environment variable
  # apiKey: <set-via-helm-install>
  apiKeyExistingSecret: datadog-secret

  # Site configuration
  site: datadoghq.com

  # Cluster identification
  clusterName: aks-cluster

  # Log level
  logLevel: INFO

  # Enable Kubernetes state metrics
  kubeStateMetricsEnabled: true

  # Cluster checks for service discovery
  clusterChecks:
    enabled: true

  # Tags applied to all metrics/logs
  tags:
    - "env:dev"
    - "cloud:azure"
    - "platform:aks"

  # Collect Kubernetes events
  collectEvents: true
  leaderElection: true

  # Container runtime (containerd for modern AKS)
  criSocketPath: /var/run/containerd/containerd.sock

  # APM configuration
  apm:
    portEnabled: true
    port: 8126
    socketEnabled: true
    socketPath: /var/run/datadog/apm.socket

  # Process Agent
  processAgent:
    enabled: true
    processCollection: true
    containerCollection: true

  # Log collection
  logs:
    enabled: true
    containerCollectAll: true
    containerCollectUsingFiles: true

  # Network Performance Monitoring
  networkMonitoring:
    enabled: false  # Enable if needed, requires kernel headers

  # Security Agent (disabled by default)
  securityAgent:
    runtime:
      enabled: false
    compliance:
      enabled: false

  # OTLP ingestion (OpenTelemetry support)
  otlp:
    receiver:
      protocols:
        grpc:
          enabled: false
        http:
          enabled: false

# Cluster Agent configuration
clusterAgent:
  enabled: true
  replicas: 1 # Single replica for demo - saves resources

  image:
    repository: gcr.io/datadoghq/cluster-agent
    tag: "7.60.0"
    pullPolicy: IfNotPresent

  resources:
    requests:
      cpu: 50m # Reduced for demo
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

  # Metrics provider for HPA
  metricsProvider:
    enabled: true
    useDatadogMetrics: true

  # Admission controller for auto-instrumentation
  admissionController:
    enabled: true
    mutateUnlabelled: false

# Node Agent (DaemonSet) configuration
agents:
  enabled: true

  image:
    repository: gcr.io/datadoghq/agent
    tag: "7.60.0"
    pullPolicy: IfNotPresent

  # Container resources - optimized for demo
  containers:
    agent:
      resources:
        requests:
          cpu: 100m # Reduced for smaller nodes
          memory: 128Mi
        limits:
          cpu: 250m
          memory: 256Mi

    processAgent:
      resources:
        requests:
          cpu: 50m
          memory: 64Mi
        limits:
          cpu: 100m
          memory: 128Mi

    traceAgent:
      resources:
        requests:
          cpu: 50m
          memory: 64Mi
        limits:
          cpu: 100m
          memory: 128Mi

  # Tolerations to run on all nodes
  tolerations:
    - operator: Exists

  # Use host network for better performance
  useHostNetwork: false

  # Priority class
  priorityClassName: system-node-critical

# Kube State Metrics configuration
kube-state-metrics:
  nodeSelector:
    kubernetes.io/os: linux

  resources:
    requests:
      cpu: 50m # Reduced for demo
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 128Mi

# Provider-specific settings for Azure
providers:
  aks:
    enabled: true
